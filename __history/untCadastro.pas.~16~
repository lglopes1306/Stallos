unit untCadastro;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, REST.Types, REST.Client,
  Data.Bind.Components, Data.Bind.ObjectScope, Vcl.StdCtrls, Vcl.ExtCtrls,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  Data.DB, Vcl.Mask, Vcl.DBCtrls, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  REST.Response.Adapter;

type
  TfrmCadastro = class(TForm)
    Panel1: TPanel;
    RESTClient1: TRESTClient;
    RESTRequest1: TRESTRequest;
    RESTResponse1: TRESTResponse;
    RESTResponseDataSetAdapter1: TRESTResponseDataSetAdapter;
    FDMemTable1: TFDMemTable;
    FDMemTable1cep: TWideStringField;
    FDMemTable1logradouro: TWideStringField;
    FDMemTable1complemento: TWideStringField;
    FDMemTable1bairro: TWideStringField;
    FDMemTable1localidade: TWideStringField;
    FDMemTable1uf: TWideStringField;
    FDMemTable1ibge: TWideStringField;
    FDMemTable1gia: TWideStringField;
    FDMemTable1ddd: TWideStringField;
    FDMemTable1siafi: TWideStringField;
    Label1: TLabel;
    edtCEP: TDBEdit;
    DataSource1: TDataSource;
    Label2: TLabel;
    edtLogradouro: TDBEdit;
    Label3: TLabel;
    DBEdit3: TDBEdit;
    Label4: TLabel;
    DBEdit4: TDBEdit;
    Label5: TLabel;
    DBEdit5: TDBEdit;
    Label6: TLabel;
    DBEdit6: TDBEdit;
    procedure btnBotãoClick(Sender: TObject);
    procedure edtCEPExit(Sender: TObject);
  private
    { Private declarations }
    function ValidaCampo(NomeCampo : string): Boolean;
  public
    { Public declarations }
  end;

var
  frmCadastro: TfrmCadastro;

implementation

{$R *.dfm}

procedure TfrmCadastro.btnBotãoClick(Sender: TObject);
begin
   RESTClient1.BaseURL := 'https://viacep.com.br/ws/'+edtCEP.Text+'/json/';
   RESTRequest1.Execute;
end;

procedure TfrmCadastro.edtCEPExit(Sender: TObject);
begin

try
  if ValidaCampo('edtCEP') then
  begin
      RESTClient1.BaseURL := 'https://viacep.com.br/ws/'+edtCEP.Text+'/json/';
      RESTRequest1.Execute;
  end;

Except on e:Exception do
  ShowMessage('Verifique se o preencimento do CEP está correto!'+#13+#10+'Erro: '+e.Message);

end;

end;

function TfrmCadastro.ValidaCampo(NomeCampo : string): Boolean;
var
   ind : integer;
   Resultado :  Boolean;
begin

   Resultado := True;

   for ind := 0 to frmCadastro.ComponentCount - 1 do
   begin
        if frmCadastro.Components[ind].ClassType = TDBEdit then
        begin

          if frmCadastro.Components[ind].Name = NomeCampo then
          begin

            if TDBEdit(frmCadastro.Components[ind]).Text = '' then
            begin
                 Application.MessageBox('Existe(m) campo(s) obrigatório(s) não preenchido(s)!','Atenção!',MB_OK+MB_ICONEXCLAMATION);
                 TDBEdit(frmCadastro.Components[ind]).SetFocus;
                 Resultado := False;
            end;

          end;

        end;
   end;

   Result := Resultado;

end;

end.
